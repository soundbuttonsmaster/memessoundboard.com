import{uploadSound as b}from"./api.Ba0nkDO7.js";import{getAuthToken as E}from"./auth.BPmtC0_i.js";import"./hoisted.CLv4g-nk.js";const h=document.getElementById("authCheckState");document.getElementById("notAuthenticatedState");const B=document.getElementById("authenticatedContent"),f=E();f?(h.style.display="none",B.style.display="block"):window.location.href="/login";const m=document.getElementById("uploadForm"),a=document.getElementById("sound_file"),s=document.getElementById("fileUploadArea"),u=s.querySelector(".upload-placeholder"),c=document.getElementById("fileInfo"),g=document.getElementById("fileName"),I=document.getElementById("removeFile"),l=document.getElementById("errorMessage"),y=document.getElementById("successMessage"),r=document.getElementById("submitBtn");s.addEventListener("click",()=>{(!c.style.display||c.style.display==="none")&&a.click()});a.addEventListener("change",t=>{const e=t.target.files?.[0];if(e){if(e.size>10*1024*1024){l.textContent="File size must be less than 10MB",l.style.display="block",a.value="";return}g.textContent=e.name,u.style.display="none",c.style.display="flex"}});I.addEventListener("click",t=>{t.stopPropagation(),a.value="",u.style.display="block",c.style.display="none"});s.addEventListener("dragover",t=>{t.preventDefault(),s.classList.add("drag-over")});s.addEventListener("dragleave",()=>{s.classList.remove("drag-over")});s.addEventListener("drop",t=>{t.preventDefault(),s.classList.remove("drag-over");const e=t.dataTransfer?.files[0];if(e){if(e.size>10*1024*1024){l.textContent="File size must be less than 10MB",l.style.display="block";return}const o=new DataTransfer;o.items.add(e),a.files=o.files,g.textContent=e.name,u.style.display="none",c.style.display="flex"}});m.addEventListener("submit",async t=>{t.preventDefault();const e=r.querySelector(".button-text"),o=r.querySelector(".button-loader");l.style.display="none",y.style.display="none",e.style.display="none",o.style.display="inline-block",r.disabled=!0;const d=new FormData(m),p=a.files?.[0];if(!p){l.textContent="Please select an audio file",l.style.display="block",e.style.display="inline",o.style.display="none",r.disabled=!1;return}const i=new FormData;i.append("name",d.get("name")),i.append("sound_file",p),d.get("category")&&i.append("category",d.get("category")),d.get("tags")&&i.append("tag",d.get("tags"));try{console.log("Starting upload...");const n=await b(f,i);if(console.log("Upload result:",n),n&&typeof n=="object"&&"id"in n&&"name"in n)console.log("Upload successful, redirecting..."),y.textContent="Sound uploaded successfully! Redirecting...",y.style.display="block",setTimeout(()=>{const v=n.name.toLowerCase().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"");window.location.href=`/instant/${v}-${n.id}`},1500);else throw console.error("Invalid upload result:",n),new Error("Upload failed - invalid response")}catch(n){l.textContent=n.message||"Upload failed. Please try again.",l.style.display="block"}finally{e.style.display="inline",o.style.display="none",r.disabled=!1}});
