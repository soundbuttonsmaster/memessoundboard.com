import{updateUserProfile as u,getUserProfile as y,fetchUserFavorites as f,fetchUserUploadedSounds as g}from"./api.Ba0nkDO7.js";import{getAuthToken as p,logout as E,getUserData as B}from"./auth.BPmtC0_i.js";import"./hoisted.CLv4g-nk.js";const l=p();l||(window.location.href="/login");async function _(){const e=B();e&&m(e);try{const t=await y(l);t&&(m(t),setUserData(t))}catch(t){console.error("Failed to load profile:",t)}try{const[t,o]=await Promise.all([f(l,1,1),g(l,1,1)]);document.getElementById("favoritesCount").textContent=t.count.toString(),document.getElementById("uploadsCount").textContent=o.count.toString()}catch(t){console.error("Failed to load stats:",t)}}function m(e){const t=e.full_name||e.username||"User",o=t.split(" ").map(n=>n[0]).join("").toUpperCase().slice(0,2);document.getElementById("avatarInitials").textContent=o,document.getElementById("profileName").textContent=t,document.getElementById("profileEmail").textContent=e.email||"-",document.getElementById("email").value=e.email||"",document.getElementById("first_name").value=e.first_name||"",document.getElementById("last_name").value=e.last_name||"",document.getElementById("phone_number").value=e.phone_number||"",document.getElementById("infoUsername").textContent=e.username||"-",document.getElementById("infoDateJoined").textContent=e.date_joined?new Date(e.date_joined).toLocaleDateString():"-",document.getElementById("infoLastLogin").textContent=e.last_login?new Date(e.last_login).toLocaleDateString():"Never",document.getElementById("infoStatus").textContent=e.is_active?"Active":"Inactive"}const c=document.getElementById("profileForm"),r=document.getElementById("errorMessage"),d=document.getElementById("successMessage"),i=document.getElementById("saveBtn");c?.addEventListener("submit",async e=>{e.preventDefault();const t=i.querySelector(".button-text"),o=i.querySelector(".button-loader");r.style.display="none",d.style.display="none",t.style.display="none",o.style.display="inline-block",i.disabled=!0;const n=new FormData(c),s={};n.get("first_name")&&(s.first_name=n.get("first_name")),n.get("last_name")&&(s.last_name=n.get("last_name")),n.get("phone_number")&&(s.phone_number=n.get("phone_number"));try{const a=await u(l,s);if(a)setUserData(a),m(a),d.textContent="Profile updated successfully!",d.style.display="block";else throw new Error("Failed to update profile")}catch(a){r.textContent=a.message||"Failed to update profile. Please try again.",r.style.display="block"}finally{t.style.display="inline",o.style.display="none",i.disabled=!1}});document.getElementById("logoutBtn")?.addEventListener("click",()=>{E()});_();
